%% Define mesh 
XLim = [-35 35];
YLim = [-20 20];
%
xline = linspace(XLim(1),XLim(2),50);
yline = linspace(YLim(1),YLim(2),50);
%
[xms ,yms] = meshgrid(xline,yline);
zms = Vfh(xms,yms);
%% Define Figure
figure('unit','norm','pos',[0.0 0.0 1.0 1.0])
hold on 

%% Surface
isurf = surf(xms,yms,zms,'FaceLighting','gouraud');
shading interp
% 
isurf = mesh(xms,yms,zms,'MeshStyle','row');
isurf.FaceColor = 'none';
isurf.CData =  isurf.CData +10;
%% Show Surface


%% Sphere
pause(1)
% Create the mesh of shere
[X,Y,Z] = sphere;
radius = 2;
X = X*radius; Y = Y*radius; Z = Z*radius;
% create the sphere object
isphere = surf(X,Y,Z);
shading interp
% set color of sphere
isphere.CData = isphere.CData*0 + 1;
isphere.FaceLighting = 'gouraud';
isphere.Parent.Parent.Color = [0 0 0];
%
%% Fixed Limits of Graphs
isurf.Parent.XLim = XLim;
isurf.Parent.YLim = YLim;
isurf.Parent.ZLim = isurf.Parent.ZLim;
%% setting axes 
daspect([1 1 1])
lightangle(165,73)
axis(isurf.Parent,'off')
%%
%
x = StateSolution(1,1);
y =  StateSolution(1,2);
z = Vfh(StateSolution(1,1),StateSolution(1,2)) + radius + 0.5;
    
l1 = line(x,y,z - radius - 0.5,'LineStyle','-','Color','red','LineWidth',1.5);
isphere.XData = X + x;
isphere.YData = Y + y;
isphere.ZData = Z + z;
%%

AzAngle = -210; 
ElAngle   = 37;
view(isurf.Parent,AzAngle,ElAngle)
%%
% delete('animation.gif')
% gif('animation.gif','frame',isurf.Parent.Parent,'DelayTime',1/11) % <= to create gif
%%
for it = 1:1:dynamics.Nt
    % change the sphere position
    x = StateSolution(it,1);
    y =  StateSolution(it,2);
    z = Vfh(StateSolution(it,1),StateSolution(it,2)) + radius + 0.5;
    %
    isphere.XData = X + x;
    isphere.YData = Y + y;
    isphere.ZData = Z + z;
    %
    l1.XData(end+1) = x;
    l1.YData(end+1) = y;
    l1.ZData(end+1) = z -radius - 0.5;


    % change the Azimutal Angle in 0.1 degree
    AzAngle = AzAngle + 0.1;
    ElAngle = ElAngle + 0.125;
    view(isurf.Parent,AzAngle,ElAngle)
    % pause for see the update graphs 
    pause(0.05)
    % get frame of figure
    %gif('frame',isurf.Parent.Parent) % <== to create gif
    % stop animation when the potential is very high
    if abs(Vfh(StateSolution(it,1),StateSolution(it,2))) > 300
        break
    end
end
